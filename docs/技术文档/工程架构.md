# AI智能巡检系统 - 工程架构

## 1.1 模块结构

```
ai_inspection/
├── src/main/java/org/example/
│   ├── Application.java              # 应用启动入口
│   ├── config/                       # 配置管理层
│   │   ├── DashScopeApiConfig.java   # AI服务配置
│   │   └── EnvTypeConfig.java        # 环境类型配置
│   ├── controller/                   # Web接口层
│   │   ├── HealthController.java     # 健康检查控制器
│   │   ├── IndexController.java      # 主页控制器
│   │   ├── InspectionPromptController.java    # Prompt管理控制器
│   │   ├── InspectionResultController.java    # 巡检结果控制器
│   │   └── InspectionTagController.java       # 标签管理控制器
│   ├── service/                      # 业务逻辑层
│   │   ├── impl/                     # 业务实现类
│   │   │   ├── InspectionPromptServiceImpl.java
│   │   │   ├── InspectionResultServiceImpl.java
│   │   │   ├── InspectionTagServiceImpl.java
│   │   │   └── PicCompareServiceImpl.java
│   │   ├── InspectionPromptService.java
│   │   ├── InspectionResultService.java
│   │   ├── InspectionTagService.java
│   │   └── PicCompareService.java
│   ├── job/                          # 定时任务层
│   │   ├── InspectionCheckProcessor.java      # 巡检任务处理器
│   │   └── PageScreenshotProcessor.java       # 页面截图处理器
│   ├── tools/                        # 工具组件层
│   │   ├── ComparisonTool.java       # 比较工具接口
│   │   ├── ComparisonToolManager.java # 工具管理器
│   │   ├── FluctuationAnalysisTool.java       # 波动分析工具
│   │   ├── JsonComparisonTool.java   # JSON比较工具
│   │   ├── NumberComparisonTool.java # 数值比较工具
│   │   ├── StringComparisonTool.java # 字符串比较工具
│   │   ├── ThresholdComparisonTool.java       # 阈值比较工具
│   │   └── ToolExecutor.java         # 工具执行器
│   ├── entity/                       # 数据实体层
│   │   ├── EpmInspectionResultDO.java
│   │   ├── InspectionPrompt.java
│   │   ├── InspectionResult.java
│   │   └── InspectionTag.java
│   ├── dto/                          # 数据传输对象
│   │   ├── InspectionDTO.java
│   │   ├── InspectionIndicatorDTO.java
│   │   ├── InspectionPromptDTO.java
│   │   ├── InspectionResultDTO.java
│   │   ├── InspectionTagDTO.java
│   │   └── NumberComparisonResult.java
│   ├── mapper/                       # 数据访问层
│   │   ├── InspectionPromptMapper.java
│   │   ├── InspectionResultMapper.java
│   │   └── InspectionTagMapper.java
│   ├── query/                        # 查询参数对象
│   │   ├── EpmInspectionResultParam.java
│   │   ├── InspectionPromptQuery.java
│   │   ├── InspectionQuery.java
│   │   ├── InspectionResultQuery.java
│   │   └── InspectionTagQuery.java
│   ├── result/                       # 结果封装类
│   │   ├── BaseResult.java
│   │   ├── PojoResult.java
│   │   └── ProcessResult.java
│   ├── enums/                        # 枚举类
│   │   ├── CheckFlagEnum.java
│   │   ├── InspectionTypeEnum.java
│   │   └── YNTypeEnum.java
│   └── utils/                        # 工具类
│       ├── JsonCleanerUtils.java
│       └── JsonUtils.java
└── src/main/resources/
    ├── static/                       # 静态资源
    │   ├── css/index.css
    │   ├── index.html               # 系统主页
    │   ├── tag.html                 # 标签管理页面
    │   ├── prompt.html              # Prompt管理页面
    │   ├── inspection.html          # 巡检结果页面
    │   └── inspection_page/         # 额外页面资源
    ├── mapper/                       # MyBatis映射文件
    │   ├── InspectionPromptMapper.xml
    │   ├── InspectionResultMapper.xml
    │   └── InspectionTagMapper.xml
    ├── application.yml               # 应用配置文件
    ├── inspection_prompt.sql         # Prompt表结构
    ├── inspection_result.sql         # 巡检结果表结构
    └── inspection_tag.sql            # 标签表结构
```

## 1.2 模块依赖关系

```
Application (启动入口)
├── Controller (Web接口层)
├── Service (业务逻辑层)
├── Job (定时任务层)
└── Config (配置管理层)

Controller
├── Service
└── Result

Service
├── Mapper (数据访问层)
├── Tools (工具组件层)
├── Entity
├── DTO
└── Utils

Job
├── Service
├── Mapper
└── Tools

Tools
├── Entity
├── DTO
└── Utils

Mapper
├── Entity
└── Query

Config
└── [独立模块]

Utils
└── [基础模块]
```

## 1.3 系统架构图

```
┌─────────────────┐    ┌─────────────────┐
│   React前端应用   │    │   Ant Design UI │
└─────────────────┘    └─────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Web表示层                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 健康检查     │  │ 标签管理     │  │ Prompt管理   │            │
│  │ Controller  │  │ Controller  │  │ Controller  │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│  ┌─────────────┐  ┌─────────────┐                              │
│  │ 巡检结果     │  │ 主页控制     │                              │
│  │ Controller  │  │ Controller  │                              │
│  └─────────────┘  └─────────────┘                              │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    业务逻辑层                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 标签管理     │  │ Prompt管理   │  │ 巡检结果     │            │
│  │ Service     │  │ Service     │  │ Service     │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│  ┌─────────────┐  ┌─────────────┐                              │
│  │ 图片比较     │  │ 定时任务     │                              │
│  │ Service     │  │ Processor   │                              │
│  └─────────────┘  └─────────────┘                              │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    工具组件层                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 阈值比较     │  │ 波动分析     │  │ 字符串比较   │            │
│  │ Tool        │  │ Tool        │  │ Tool        │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ JSON比较     │  │ 数值比较     │  │ 工具管理器   │            │
│  │ Tool        │  │ Tool        │  │ Manager     │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    数据访问层                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 标签数据     │  │ Prompt数据   │  │ 结果数据     │            │
│  │ Mapper      │  │ Mapper      │  │ Mapper      │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    基础设施层                                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │    H2       │  │ DashScope   │  │ Playwright  │            │
│  │  Database   │  │   AI API    │  │ Browser     │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│  ┌─────────────┐  ┌─────────────┐                              │
│  │   MyBatis   │  │ Spring Boot │                              │
│  │    ORM      │  │ Framework   │                              │
│  └─────────────┘  └─────────────┘                              │
└─────────────────────────────────────────────────────────────────┘
```

## 1.4 模块职责详细说明

| 模块名称 | 职责描述 | 主要功能 | 技术特点 |
|----------|----------|----------|----------|
| Controller层 | HTTP接口暴露、参数校验、权限控制 | RESTful API、前端交互、跨域支持 | Spring MVC、CORS配置、统一响应格式 |
| Service层 | 业务流程编排、业务规则实现、外部服务调用 | 标签管理、Prompt管理、巡检执行、AI分析 | 业务服务、AI集成、定时任务 |
| Job层 | 定时任务调度、自动化流程控制 | 定时巡检、页面截图、结果处理 | Spring Scheduler、Playwright集成 |
| Tools层 | 智能比较工具、数据分析组件 | 阈值判断、波动分析、数据比较 | 策略模式、工具链管理 |
| Mapper层 | 数据持久化、数据查询、数据映射 | CRUD操作、复杂查询、事务管理 | MyBatis、SQL映射、连接池 |
| Config层 | 配置管理、环境适配、外部服务配置 | AI服务配置、环境变量、应用配置 | Spring Configuration、配置注入 |
| Entity/DTO层 | 数据模型定义、对象转换 | 数据结构定义、字段映射、数据传输 | Java Bean、Lombok、数据校验 |

## 1.5 技术架构特点

- **分层架构**: 采用经典的分层架构模式，职责清晰，易于维护和扩展
- **组件化设计**: 工具组件层支持插件式扩展，新增比较工具无需修改核心逻辑
- **AI服务集成**: 深度集成阿里云DashScope服务，支持多模态智能分析
- **前后端分离**: React前端与Spring Boot后端完全分离，支持独立部署和扩展
- **数据驱动**: 基于配置化的巡检策略，支持动态调整和优化
- **异步处理**: 定时任务和AI分析采用异步处理，提升系统并发能力
- **模块解耦**: 各层模块松耦合设计，支持单独测试和独立演进

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 巡检结果管理</title>
    <link rel="stylesheet" href="css/index.css">
    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://unpkg.com/antd@4.24.15/dist/antd.min.css">
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Ant Design JavaScript -->
    <script src="https://unpkg.com/antd@4.24.15/dist/antd.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Table, Button, Input, Form, Modal, message, Spin, Tag, Select, Popconfirm } = antd;

        // API 调用函数
        const tagApi = {
            queryValidTags: async () => {
                try {
                    const response = await fetch('/api/tag/valid', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: API服务器未响应`);
                    }
                    const result = await response.json();
                    if (result.success) {
                        return result.content || [];
                    } else {
                        console.error('查询标签失败:', result.errorMsg);
                        return [];
                    }
                } catch (error) {
                    console.error('查询标签API调用错误:', error);
                    return [];
                }
            }
        };

        const inspectionApi = {
            queryInspectionResults: async (queryParams = {}) => {
                try {
                    console.log('调用API /api/inspection/query，参数:', queryParams);
                    
                    // 尝试调用真实API
                    const response = await fetch('/api/inspection/query', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(queryParams)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: API服务器未响应`);
                    }
                    
                    const result = await response.json();
                    console.log('API响应:', result);
                    
                    if (result.success) {
                        return result.content || [];
                    } else {
                        console.error('查询失败:', result.errorMsg);
                        throw new Error(result.errorMsg || '查询失败');
                    }
                } catch (error) {
                    console.error('API调用错误:', error);
                    // 在开发环境中，如果API不可用，返回空数组
                    console.warn('API不可用，返回空数据。请启动Spring Boot应用以获取真实数据。');
                    return [];
                }
            },
            
            addInspectionCase: async (data) => {
                try {
                    const response = await fetch('/api/inspection/add', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    return result;
                } catch (error) {
                    console.error('新增API调用错误:', error);
                    throw error;
                }
            },
            
            updateInspectionCase: async (data) => {
                try {
                    const response = await fetch('/api/inspection/update', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    const result = await response.json();
                    return result;
                } catch (error) {
                    console.error('更新API调用错误:', error);
                    throw error;
                }
            },
            
            deleteInspectionCase: async (id) => {
                try {
                    const response = await fetch(`/api/inspection/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    const result = await response.json();
                    return result;
                } catch (error) {
                    console.error('删除API调用错误:', error);
                    throw error;
                }
            }
        };

        const InspectionResults = () => {
            const [tableDataList, setTableDataList] = useState([]);
            const [tableLoading, setTableLoading] = useState(false);
            const [modalVisible, setModalVisible] = useState(false);
            const [editMode, setEditMode] = useState(false);
            const [formData, setFormData] = useState({});
            const [modalLoading, setModalLoading] = useState(false);
            
            // 解析URL参数
            const urlParams = new URLSearchParams(window.location.search);
            const tagFromUrl = urlParams.get('tag') || '';
            const tagNameFromUrl = urlParams.get('tagName') || '';
            const hideTagSelect = urlParams.get('hideTagSelect') === 'true';
            
            const [queryParams, setQueryParams] = useState({
                workNo: '',
                checkFlag: '',
                inspectionType: '',
                tag: tagFromUrl
            });
            const [tagOptions, setTagOptions] = useState([]);
            const [imageModalVisible, setImageModalVisible] = useState(false);
            const [currentImage, setCurrentImage] = useState({ url: '', title: '' });

            useEffect(() => {
                queryTableList();
                loadTagOptions();
            }, []);

            const loadTagOptions = async () => {
                try {
                    const tags = await tagApi.queryValidTags();
                    setTagOptions(tags);
                } catch (error) {
                    console.error('加载标签选项失败:', error);
                }
            };

            const queryTableList = async () => {
                setTableLoading(true);
                try {
                    const results = await inspectionApi.queryInspectionResults(queryParams);
                    setTableDataList(results || []);
                    setTableLoading(false);
                } catch (error) {
                    console.error('查询失败:', error);
                    message.error(`查询失败: ${error.message}`);
                    setTableLoading(false);
                }
            };

            // 新增功能
            const handleAdd = () => {
                setEditMode(false);
                setFormData({
                    tag: hideTagSelect ? tagFromUrl : (queryParams.tag || ''), // 隐藏模式下使用URL中的tag
                    workNo: '',
                    methodName: '',
                    checkFlag: 'U', // 默认未检查
                    inspectionType: 'page', // 默认页面
                    promptContent: '', // 改为promptContent字段
                    errorMsg: '[]', // 默认无错误
                    thisResp: '', // 默认空
                    lastResp: '' // 默认空
                });
                setModalVisible(true);
            };

            // 编辑功能
            const handleEdit = (record) => {
                // 从req字段中解析prompt内容
                let promptContent = '';
                try {
                    const reqData = JSON.parse(record.req || '{}');
                    promptContent = reqData.prompt || '';
                } catch (e) {
                    promptContent = record.req || '';
                }
                
                setEditMode(true);
                setFormData({
                    id: record.id,
                    tag: record.tag,
                    workNo: record.workNo,
                    methodName: record.methodName,
                    checkFlag: record.checkFlag,
                    inspectionType: record.inspectionType,
                    promptContent: promptContent, // 使用解析出的prompt内容
                    errorMsg: record.errorMsg || '[]',
                    thisResp: record.thisResp || '',
                    lastResp: record.lastResp || ''
                });
                setModalVisible(true);
            };

            // 删除功能
            const handleDelete = async (record) => {
                try {
                    const result = await inspectionApi.deleteInspectionCase(record.id);
                    if (result.success) {
                        message.success('删除成功');
                        queryTableList();
                    } else {
                        message.error(result.errorMsg || '删除失败');
                    }
                } catch (error) {
                    console.error('删除失败:', error);
                    message.error(`删除失败: ${error.message}`);
                }
            };

            // 保存功能
            const handleSave = async () => {
                setModalLoading(true);
                try {
                    // 构造req字段，包含prompt和图片信息
                    const reqData = {
                        prompt: formData.promptContent || '',
                        thisPicName: '', // 可以根据需要填充
                        lastPicName: ''  // 可以根据需要填充
                    };
                    
                    // 准备保存的数据
                    const saveData = {
                        ...formData,
                        req: JSON.stringify(reqData) // 将prompt等信息序列化到req字段
                    };
                    
                    // 移除临时字段
                    delete saveData.promptContent;
                    
                    let result;
                    if (editMode) {
                        result = await inspectionApi.updateInspectionCase(saveData);
                    } else {
                        result = await inspectionApi.addInspectionCase(saveData);
                    }
                    
                    if (result.success) {
                        message.success(editMode ? '更新成功' : '新增成功');
                        setModalVisible(false);
                        queryTableList();
                    } else {
                        message.error(result.errorMsg || (editMode ? '更新失败' : '新增失败'));
                    }
                } catch (error) {
                    console.error('保存失败:', error);
                    message.error(`保存失败: ${error.message}`);
                } finally {
                    setModalLoading(false);
                }
            };

            // 取消功能
            const handleCancel = () => {
                setModalVisible(false);
                setFormData({});
            };

            // 显示图片模态框
            const showImageModal = async (imageName, title, recordId) => {
                try {
                    // 调用接口获取图片内容
                    const response = await fetch(`/api/inspection/queryEpmInspectionPicture?id=${recordId}&picName=${imageName}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: 图片查询失败`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success && result.content) {
                        // 假设返回的是base64格式的图片或者图片URL
                        let imageUrl = result.content;
                        
                        // 如果返回的是base64格式，需要添加data URL前缀
                        if (!imageUrl.startsWith('http') && !imageUrl.startsWith('data:')) {
                            imageUrl = `data:image/png;base64,${imageUrl}`;
                        }
                        
                        setCurrentImage({ url: imageUrl, title: title });
                        setImageModalVisible(true);
                    } else {
                        message.error(result.errorMsg || '图片获取失败');
                    }
                } catch (error) {
                    console.error('图片查询失败:', error);
                    message.error(`图片查询失败: ${error.message}`);
                }
            };

            // 关闭图片模态框
            const handleImageModalCancel = () => {
                setImageModalVisible(false);
                setCurrentImage({ url: '', title: '' });
            };

            // 根据业务类型和方法名查询prompt
            const fetchPromptByTagAndMethod = async (tag, methodName) => {
                if (!tag || !methodName) {
                    return '';
                }
                
                try {
                    const response = await fetch('/api/prompt/query', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            tag: tag,
                            methodName: methodName
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: Prompt查询失败`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.success && result.content && result.content.length > 0) {
                        // 返回第一个匹配的prompt内容
                        return result.content[0].promptContent || '';
                    } else {
                        console.warn('未找到匹配的prompt');
                        return '';
                    }
                } catch (error) {
                    console.error('查询prompt失败:', error);
                    message.warning(`查询prompt失败: ${error.message}`);
                    return '';
                }
            };

            // 当方法名变化时自动查询prompt
            const handleMethodNameChange = async (methodName) => {
                setFormData({...formData, methodName: methodName});
                
                if (methodName && formData.tag) {
                    const promptContent = await fetchPromptByTagAndMethod(formData.tag, methodName);
                    setFormData(prev => ({...prev, promptContent: promptContent, methodName: methodName}));
                }
            };

            const columns = [
                {
                    title: 'ID',
                    dataIndex: 'id',
                    key: 'id',
                    width: 80,
                },
                {
                    title: '业务类型',
                    dataIndex: 'tag',
                    key: 'tag',
                    width: 120,
                },
                {
                    title: '工号',
                    dataIndex: 'workNo',
                    key: 'workNo',
                    width: 100,
                },
                {
                    title: '方法名',
                    dataIndex: 'methodName',
                    key: 'methodName',
                    width: 150,
                },
                {
                    title: 'Prompt',
                    dataIndex: 'req',
                    key: 'prompt',
                    width: 250,
                    render: (text, record) => {
                        if (!text || text === '') {
                            return React.createElement('span', { style: { color: '#ccc' } }, '无Prompt');
                        }
                        
                        let promptText = '';
                        try {
                            const reqData = JSON.parse(text);
                            promptText = reqData.prompt || '';
                        } catch (e) {
                            // 如果不是JSON格式，可能整个文本就是prompt
                            promptText = text;
                        }
                        
                        if (promptText) {
                            const displayText = promptText.length > 50 ? promptText.substring(0, 50) + '...' : promptText;
                            return React.createElement('span', { 
                                title: promptText,
                                style: { cursor: 'help' }
                            }, displayText);
                        } else {
                            return React.createElement('span', { style: { color: '#ccc' } }, '无Prompt');
                        }
                    },
                },
                {
                    title: '请求参数',
                    dataIndex: 'req',
                    key: 'req',
                    width: 200,
                    render: (text, record) => {
                        if (!text || text === '') {
                            return React.createElement('span', { style: { color: '#ccc' } }, '无参数');
                        }
                        
                        let thisPicName = '';
                        let lastPicName = '';
                        
                        try {
                            const reqData = JSON.parse(text);
                            thisPicName = reqData.thisPicName || '';
                            lastPicName = reqData.lastPicName || '';
                        } catch (e) {
                            return React.createElement('span', { 
                                title: text,
                                style: { cursor: 'help', color: '#999' }
                            }, '参数格式错误');
                        }
                        
                        if (thisPicName || lastPicName) {
                            return React.createElement('div', null,
                                thisPicName ? React.createElement('div', null,
                                    React.createElement('span', { style: { fontSize: '12px', color: '#666' } }, '当前: '),
                                    React.createElement(Button, {
                                        type: 'link',
                                        size: 'small',
                                        onClick: () => showImageModal(thisPicName, '当前图片', record.id),
                                        style: { padding: 0, height: 'auto', fontSize: '12px' }
                                    }, thisPicName)
                                ) : null,
                                lastPicName ? React.createElement('div', null,
                                    React.createElement('span', { style: { fontSize: '12px', color: '#666' } }, '上次: '),
                                    React.createElement(Button, {
                                        type: 'link',
                                        size: 'small',
                                        onClick: () => showImageModal(lastPicName, '上次图片', record.id),
                                        style: { padding: 0, height: 'auto', fontSize: '12px' }
                                    }, lastPicName)
                                ) : null
                            );
                        } else {
                            return React.createElement('span', { style: { color: '#ccc' } }, '无图片参数');
                        }
                    },
                },
                {
                    title: '检查结果',
                    dataIndex: 'checkFlag',
                    key: 'checkFlag',
                    width: 100,
                    render: (text) => (
                        React.createElement(Tag, {
                            color: text === 'Y' ? 'green' : text === 'N' ? 'red' : 'orange'
                        }, text === 'Y' ? '通过' : text === 'N' ? '不通过' : '未检查')
                    ),
                },
                {
                    title: '巡检方式',
                    dataIndex: 'inspectionType',
                    key: 'inspectionType',
                    width: 100,
                    render: (text) => (
                        React.createElement(Tag, {
                            color: text === 'api' ? 'blue' : 'purple'
                        }, text === 'api' ? 'API' : '页面')
                    ),
                },
                {
                    title: '错误信息',
                    dataIndex: 'errorMsg',
                    key: 'errorMsg',
                    width: 400,
                    render: (text, record) => {
                        // 如果没有错误信息
                        if (!text || text === '[]' || text === '') {
                            return React.createElement('span', { style: { color: '#52c41a' } }, '无错误');
                        }

                        let errorData;
                        try {
                            errorData = JSON.parse(text);
                            if (Array.isArray(errorData) && errorData.length === 0) {
                                return React.createElement('span', { style: { color: '#52c41a' } }, '无错误');
                            }
                        } catch (e) {
                            errorData = text;
                        }

                        // 创建可展开的面板
                        const isDisabled = record.checkFlag === 'Y' || record.checkFlag === 'U';
                        const headerText = record.checkFlag === 'N' ? "展开 / 收起配置" : "配置已锁定";
                        
                        return React.createElement(antd.Collapse, 
                            { 
                                ghost: true,
                                size: 'small'
                            },
                            React.createElement(antd.Collapse.Panel, 
                                {
                                    header: headerText,
                                    key: record.id || '1',
                                    showArrow: !isDisabled,
                                    disabled: isDisabled
                                },
                                // 渲染错误信息内容
                                Array.isArray(errorData) ? 
                                    errorData.map((error, index) => 
                                        React.createElement('div', 
                                            { 
                                                key: index, 
                                                style: { marginBottom: '10px' } 
                                            },
                                            // 指标名称标签
                                            error.indicatorCode ? React.createElement(antd.Tag, 
                                                { color: 'green' }, 
                                                `[${error.indicatorCode}].${error.indicatorName || ''}【${error.indicatorName || ''}】`
                                            ) : React.createElement(antd.Tag, 
                                                { color: 'green' }, 
                                                `【${error.indicatorName || '未知指标'}】`
                                            ),
                                            React.createElement('br'),
                                            // 详细信息标签
                                            React.createElement(antd.Tag, 
                                                { color: 'geekblue' }, 
                                                `【期望值】${error.expectedValue || error.actualValue} 【实际值】${error.actualValue || error.expectedValue} 【理由】${error.reason || '无'}`
                                            )
                                        )
                                    ) :
                                    React.createElement('div', 
                                        {
                                            style: {
                                                color: '#ff4d4f',
                                                backgroundColor: '#fff2f0',
                                                padding: '8px',
                                                borderRadius: '4px',
                                                border: '1px solid #ffccc7'
                                            }
                                        },
                                        typeof errorData === 'string' ? errorData : JSON.stringify(errorData)
                                    )
                            )
                        );
                    },
                },
                {
                    title: '创建时间',
                    dataIndex: 'gmtCreate',
                    key: 'gmtCreate',
                    width: 180,
                },
                {
                    title: '更新时间',
                    dataIndex: 'gmtModified',
                    key: 'gmtModified',
                    width: 180,
                },
                {
                    title: '操作',
                    key: 'action',
                    width: 200,
                    render: (text, record) => (
                        React.createElement('div', null,
                            React.createElement(Button, {
                                type: 'link',
                                size: 'small',
                                onClick: () => handleEdit(record)
                            }, '编辑'),
                            React.createElement(Popconfirm, {
                                title: '确定要删除这条记录吗？',
                                onConfirm: () => handleDelete(record),
                                okText: '确定',
                                cancelText: '取消'
                            },
                                React.createElement(Button, {
                                    type: 'link',
                                    size: 'small',
                                    danger: true
                                }, '删除')
                            )
                        )
                    ),
                },
            ];

            return React.createElement('div', { className: 'promptRole' },
                React.createElement('div', { className: 'promptRole-header' },
                    React.createElement('h2', null, hideTagSelect ? `${tagNameFromUrl}(${tagFromUrl}) - AI 巡检结果管理` : 'AI 巡检结果管理')
                ),
                React.createElement('div', { style: { padding: '24px' } },
                    React.createElement(Form, { layout: 'inline', style: { marginBottom: '16px' } },
                        !hideTagSelect ? React.createElement(Form.Item, { label: '类型' },
                            React.createElement(Select, {
                                placeholder: '请选择业务类型',
                                value: queryParams.tag,
                                onChange: (value) => setQueryParams({...queryParams, tag: value}),
                                allowClear: true,
                                style: { width: 300 }
                            },
                                ...tagOptions.map(tag =>
                                    React.createElement(Select.Option, {
                                        key: tag.tag,
                                        value: tag.tag
                                    }, `${tag.tagName}(${tag.tag})`)
                                )
                            )
                        ) : null,
                        React.createElement(Form.Item, { label: '工号' },
                            React.createElement(Input, {
                                placeholder: '请输入工号',
                                value: queryParams.workNo,
                                onChange: (e) => setQueryParams({...queryParams, workNo: e.target.value}),
                                allowClear: true,
                                style: { width: 300 }
                            })
                        ),
                        React.createElement(Form.Item, { label: '检查结果' },
                            React.createElement(Select, {
                                placeholder: '请选择检查结果',
                                value: queryParams.checkFlag,
                                onChange: (value) => setQueryParams({...queryParams, checkFlag: value}),
                                allowClear: true,
                                style: { width: 300 }
                            },
                                React.createElement(Select.Option, { value: 'Y' }, '通过'),
                                React.createElement(Select.Option, { value: 'N' }, '不通过'),
                                React.createElement(Select.Option, { value: 'U' }, '未检查')
                            )
                        ),
                        React.createElement(Form.Item, { label: '巡检方式' },
                            React.createElement(Select, {
                                placeholder: '请选择巡检方式',
                                value: queryParams.inspectionType,
                                onChange: (value) => setQueryParams({...queryParams, inspectionType: value}),
                                allowClear: true,
                                style: { width: 300 }
                            },
                                React.createElement(Select.Option, { value: 'api' }, 'API'),
                                React.createElement(Select.Option, { value: 'page' }, '页面')
                            )
                        ),
                        React.createElement(Form.Item, null,
                            React.createElement(Button, {
                                type: 'primary',
                                onClick: () => queryTableList()
                            }, '查询')
                        ),
                        React.createElement(Form.Item, null,
                            React.createElement(Button, {
                                onClick: () => {
                                    const resetParams = { workNo: '', checkFlag: '', inspectionType: '', tag: ''};
                                    setQueryParams(resetParams);
                                    // 直接使用重置后的参数查询
                                    setTimeout(() => {
                                        setTableLoading(true);
                                        inspectionApi.queryInspectionResults(resetParams)
                                            .then(results => {
                                                setTableDataList(results || []);
                                                setTableLoading(false);
                                            })
                                            .catch(error => {
                                                console.error('查询失败:', error);
                                                message.error(`查询失败: ${error.message}`);
                                                setTableLoading(false);
                                            });
                                    }, 100);
                                }
                            }, '重置')
                        )
                    ),
                    React.createElement('div', { style: { marginBottom: '16px' } },
                        React.createElement(Button, {
                            type: 'primary',
                            onClick: handleAdd,
                            style: { marginBottom: '16px' }
                        }, '新增数据')
                    ),
                    React.createElement(Table, {
                        columns: columns,
                        dataSource: tableDataList,
                        rowKey: 'id',
                        loading: tableLoading,
                        scroll: { x: 1250 },
                        pagination: {
                            showSizeChanger: true,
                            showQuickJumper: true,
                            showTotal: (total) => `共 ${total} 条记录`,
                        }
                    }),
                    // 新增/编辑弹窗
                    React.createElement(Modal, {
                        title: editMode ? '编辑巡检案例' : '新增巡检案例',
                        open: modalVisible,
                        onOk: handleSave,
                        onCancel: handleCancel,
                        confirmLoading: modalLoading,
                        width: 600
                    },
                        React.createElement(Form, { layout: 'vertical' },
                            React.createElement('div', { style: { display: 'flex', gap: '16px' } },
                                React.createElement('div', { style: { flex: 1 } },
                                    React.createElement(Form.Item, { label: '工号' },
                                        React.createElement(Input, {
                                            value: formData.workNo,
                                            onChange: (e) => setFormData({...formData, workNo: e.target.value}),
                                            placeholder: '请输入工号'
                                        })
                                    )
                                ),
                                React.createElement('div', { style: { flex: 1 } },
                                    React.createElement(Form.Item, { label: '方法名' },
                                        React.createElement(Input, {
                                            value: formData.methodName,
                                            onChange: (e) => handleMethodNameChange(e.target.value),
                                            placeholder: '请输入方法名（输入后自动查询对应的Prompt）'
                                        })
                                    )
                                )
                            ),
                            React.createElement(Form.Item, { label: 'Prompt内容' },
                                React.createElement(antd.Input.TextArea, {
                                    value: formData.promptContent,
                                    onChange: (e) => setFormData({...formData, promptContent: e.target.value}),
                                    placeholder: '输入方法名后会自动填充对应的Prompt内容，也可手动编辑',
                                    rows: 10
                                })
                            )
                        )
                    ),
                    // 图片查看模态框
                    React.createElement(Modal, {
                        title: currentImage.title,
                        open: imageModalVisible,
                        onCancel: handleImageModalCancel,
                        footer: [
                            React.createElement(Button, {
                                key: 'download',
                                type: 'primary',
                                onClick: () => {
                                    const link = document.createElement('a');
                                    link.href = currentImage.url;
                                    
                                    // 根据图片URL类型确定文件名
                                    let fileName = 'image.png';
                                    if (currentImage.url.startsWith('data:')) {
                                        // 对于base64图片，使用默认名称
                                        fileName = `${currentImage.title.replace(/\s+/g, '_')}.png`;
                                    } else {
                                        // 对于URL图片，提取文件名
                                        fileName = currentImage.url.split('/').pop() || 'image.png';
                                    }
                                    
                                    link.download = fileName;
                                    document.body.appendChild(link);
                                    link.click();
                                    document.body.removeChild(link);
                                }
                            }, '下载'),
                            React.createElement(Button, {
                                key: 'close',
                                onClick: handleImageModalCancel
                            }, '关闭')
                        ],
                        width: 'auto',
                        centered: true,
                        style: { 
                            maxWidth: '90vw',
                            maxHeight: '90vh'
                        }
                    },
                        React.createElement('div', {
                            style: {
                                textAlign: 'center',
                                padding: '10px',
                                display: 'inline-block',
                                minWidth: '200px'
                            }
                        },
                            React.createElement('img', {
                                src: currentImage.url,
                                alt: currentImage.title,
                                style: {
                                    maxWidth: '85vw',
                                    maxHeight: '75vh',
                                    height: 'auto',
                                    width: 'auto',
                                    objectFit: 'contain',
                                    display: 'block',
                                    margin: '0 auto'
                                },
                                onError: (e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'block';
                                }
                            }),
                            React.createElement('div', {
                                style: {
                                    display: 'none',
                                    color: '#ff4d4f',
                                    fontSize: '16px',
                                    padding: '40px'
                                }
                            }, '图片加载失败或不存在')
                        )
                    )
                )
            );
        };

        // 渲染应用
        ReactDOM.render(React.createElement(InspectionResults), document.getElementById('root'));
    </script>
</body>
</html>